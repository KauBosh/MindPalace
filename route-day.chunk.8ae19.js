webpackJsonp([10],{Hy3g:function(t,e,n){"use strict";function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var u=n("KM04"),l=n("sw5u"),c=n("8EZx"),h=n("b1q8"),d=n("db16"),f=n("o6ac"),p=function(t){var e=t.onInput,n=t.id,r=t.value,i=t.label;return Object(u.h)("div",{key:n,class:"question"},Object(u.h)("label",{for:n,dir:"auto"},i),Object(u.h)("textarea",{id:n,dir:"auto",value:r,placeholder:"Start writing...",onInput:function(t){t.target.style.height="auto",t.target.getBoundingClientRect(),t.target.style.height=t.target.scrollHeight+"px",e(t.target.value)}}))},g=Object(u.h)("svg",{width:"28",height:"27",xmlns:"http://www.w3.org/2000/svg"},Object(u.h)("path",{d:"M18 9.2l9 1.4-6.5 6.4 1.5 9-8-4.3L6 26l1.5-9L1 10.6l9-1.4L14 1z",fill:"currentColor",stroke:"currentColor","stroke-width":"2","fill-rule":"evenodd","stroke-linecap":"round","stroke-linejoin":"round"})),b=function(t){var e=t.id,n=t.value,r=t.onChange;return Object(u.h)("div",{class:"stars"},[1,2,3,4,5].map(function(t){return Object(u.h)("div",null,Object(u.h)("input",{type:"checkbox",value:t,id:e+"_star_"+t,class:"screen-reader-only",checked:n&&t<=n,onChange:function(){return r(t)}}),Object(u.h)("label",{for:e+"_star_"+t,"aria-label":t+" stars"},g))}))},v=function(t){var e=t.id,n=t.value,r=t.settings,i=void 0===r?{}:r,o=t.onChange;return Object(u.h)("div",null,Object(u.h)("input",{type:"number",id:e,value:void 0!==n?n:i.default,min:i.min,max:i.max,step:i.step,autocomplete:"number-picker",onInput:function(t){o(""===t.target.value?i.default:Number(t.target.value))}}))},w=function(t){var e=t.id,n=t.value,r=t.options,i=void 0===r?[]:r,o=t.onChange;return Object(u.h)("select",{id:e,value:n,onChange:function(t){return o(t.target.value)}},i.map(function(t){return Object(u.h)("option",{key:t,value:t},t)}))},y=function(t){var e=t.id,n=t.type,r=void 0===n?"checkbox":n,i=t.value,o=t.options,s=void 0===o?[]:o,a=t.onChange;return Object(u.h)("div",null,s.map(function(t){return Object(u.h)("div",{class:"c-checkbox",key:t},Object(u.h)("input",{id:e+"_"+t,class:"screen-reader-only",type:r,checked:i.includes(t),onChange:function(){return a(t)}}),Object(u.h)("label",{for:e+"_"+t},t))}))},m=function(t){var e=t.id,n=t.value,r=t.onChange,i=n.includes(!0);return Object(u.h)("div",{class:"c-checkbox"},Object(u.h)("input",{id:e,type:"checkbox",class:"screen-reader-only",checked:i,onChange:function(){return r([!i].filter(Boolean))}}),Object(u.h)("label",{for:e},""))},k=function(t){var e=t.id,n=t.value,r=t.settings,i=void 0===r?{}:r,o=t.onChange,s=null!==n&&void 0!==n,a=s?n:i.default;return Object(u.h)("div",{class:"u-flex"},Object(u.h)("div",{class:"u-flex-1 mr20"},Object(u.h)("input",{type:"range",id:e,value:a,min:i.min,max:i.max,step:i.step,onInput:function(t){o(""===t.target.value?i.default:Number(t.target.value))}})),Object(u.h)("small",{class:"range-label"},s?a:"Not yet set"))},O=function(t){function e(){return r(this,t.apply(this,arguments))}return i(e,t),e.prototype.addStep=function(){var t=this.props.settings,e=t.max,n=void 0===e?null:e,r=t.step,i=void 0===r?1:r,o=Number(this.props.value),s=o+i;null!==n&&(s=Math.min(s,n)),this.props.onChange(s)},e.prototype.removeStep=function(){var t=this.props.settings,e=t.min,n=void 0===e?null:e,r=t.step,i=void 0===r?1:r,o=Number(this.props.value),s=o-i;null!==n&&(s=Math.max(s,n)),this.props.onChange(s)},e.prototype.render=function(t){var e=this,n=t.id,r=t.value,i=t.settings,o=void 0===i?{}:i,s=t.onChange;return Object(u.h)("div",{class:"plus-picker u-flex"},Object(u.h)("input",{class:"c-input-mini",type:"number",id:n,value:void 0!==r?r:o.default,min:o.min,max:o.max,step:o.step,autocomplete:"plus-picker",onInput:function(t){s(""===t.target.value?o.default:Number(t.target.value))}}),Object(u.h)("button",{class:"button button--mini",type:"button","aria-label":"Remove",onClick:function(){return e.removeStep()}},"-"),Object(u.h)("button",{class:"button button--mini",type:"button","aria-label":"Add",onClick:function(){return e.addStep()}},"+"))},e}(u.Component),j=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},C=Object(u.h)("div",{class:"center lift mt40"},Object(u.h)(l.Link,{href:"/get-started/",class:"button"},"Write your first question")),x=function(t){function e(){var n,r,i;o(this,e);for(var a=arguments.length,u=Array(a),l=0;l<a;l++)u[l]=arguments[l];return n=r=s(this,t.call.apply(t,[this].concat(u))),r.state={date:null,questions:null,trackingQuestions:[],highlighted:!1,clicked:!1,yesterday:null,tomorrow:null,key:""},r.getData=function(t){return new Promise(function(e,n){var i,o,s,a,u,l,d,f,p,g,b,v,w,y,m,k,O,j,C;return i=t.day,o=t.month,s=t.year,a=t.db,u=t.set,l=new Date(s,Number(o)-1,i),d=Object(c.m)(l),"Invalid Date"===l.toString()?(window.location.href=Object(c.l)(),e()):Promise.resolve(a.keys("questions")).then(function(t){try{return f=t,Promise.resolve(Promise.all(f.map(function(t){return a.get("questions",t)}))).then(function(t){try{return p=t,Promise.resolve(Object(h.b)(a)).then(function(t){try{return g=t,p.sort(function(t,e){return t.createdAt-e.createdAt}),Promise.resolve(Promise.all(p.map(function(t){return a.get("entries",d+"_"+t.slug)}))).then(function(t){try{return b=t,p.forEach(function(t,e){t.answer=b[e]||"",t.visible=!!b[e]||"live"===t.status}),Promise.resolve(a.get("highlights",d)).then(function(t){function i(){return o.call(this)}function o(){return k.length&&(O=Number(d),j=k.reduce(function(t,e){return Math.abs(e-O)<Math.abs(t-O)?e:t}),m=k.indexOf(j)),-1!==m&&(y=k[m+1]||!1,w=k[m-1]||!1,y&&(y=Object(c.i)(y.toString(),u)),w&&(w=Object(c.i)(w.toString(),u))),Promise.resolve(Promise.all(g.map(function(t){return a.get("trackingEntries",d+"_"+t.id)})).then(function(t){return t.filter(Boolean)})).then(function(t){try{return C=t,g.forEach(function(t){t.answer=C.find(function(e){return e.questionId===t.id}),t.showNotes=t.answer&&!!t.answer.notes,t.visible=!!t.answer||"live"===t.status}),r.setState({date:l,questions:p.filter(function(t){return t.visible}),trackingQuestions:g.filter(function(t){return t.visible}),key:d,highlighted:!!v,clicked:!1,yesterday:w,tomorrow:y},function(){r.setTextareaHeights()}),e()}catch(t){return n(t)}},n)}try{return v=t,w=null,y=null,m=-1,k=[],"highlights"===u?Promise.resolve(a.keys("highlights").then(function(t){return t.map(function(t){return Number(t)}).sort(function(t,e){return t-e})})).then(function(t){try{return k=t,o.call(this)}catch(t){return n(t)}}.bind(this),n):u?Promise.resolve(a.getAll("trackingEntries").then(function(t){return t.filter(function(t){return t.questionId===u}).filter(h.c).map(function(t){return t.dateString})}).then(function(t){return t.map(function(t){return Number(t)}).sort(function(t,e){return t-e})})).then(function(t){try{return k=t,i.call(this)}catch(t){return n(t)}}.bind(this),n):i.call(this)}catch(t){return n(t)}}.bind(this),n)}catch(t){return n(t)}}.bind(this),n)}catch(t){return n(t)}}.bind(this),n)}catch(t){return n(t)}}.bind(this),n)}catch(t){return n(t)}}.bind(this),n)})},r.highlightDay=function(){var t=!r.state.highlighted,e=r.state.key;t?r.props.db.set("highlights",e,!0):r.props.db.delete("highlights",e),r.setState({highlighted:t,clicked:t})},r.updateAnswer=function(t,e){var n=[].concat(r.state.questions),i=n.find(function(e){return e.slug===t});if(i){var o=r.state.key;i.answer=e,r.props.db.set("entries",o+"_"+t,e),r.setState({questions:n})}},r.updateTrackingAnswer=function(t,e){var n=r.state.key,i=[].concat(r.state.trackingQuestions),o=i.find(function(e){return e.id===t});if(o){var s=n+"_"+t,a=o.answer||{id:s,questionId:t,createdAt:Date.now(),dateString:n,value:e,notes:""};"string"!=typeof o.notes||o.showNotes||(o.showNotes=!0),o.answer=j({},a,{value:e}),r.props.db.set("trackingEntries",s,o.answer),r.setState({trackingQuestions:i})}},r.toggleTrackingOption=function(t,e){var n=r.state.key,i=[].concat(r.state.trackingQuestions),o=i.find(function(e){return e.id===t});if(o){var s=n+"_"+t,a=[],u=o.answer||{id:s,questionId:t,createdAt:Date.now(),dateString:n,value:o.settings.default||[],notes:""};if("checkbox"===o.settings.type){a=u.value.includes(e)?u.value.filter(function(t){return t!==e}):[].concat(u.value,e)}else a=[e];o.answer=j({},u,{value:a}),r.props.db.set("trackingEntries",s,o.answer),r.setState({trackingQuestions:i})}},r.updateTrackingNotes=function(t,e){var n=r.state.key,i=[].concat(r.state.trackingQuestions),o=i.find(function(e){return e.id===t});if(o){var s=n+"_"+t,a=o.answer||{id:s,questionId:t,createdAt:Date.now(),dateString:n,value:o.settings.default||null,notes:e};o.answer=j({},a,{notes:e}),r.props.db.set("trackingEntries",s,o.answer),r.setState({trackingQuestions:i})}},r.showNotes=function(t){var e=[].concat(r.state.trackingQuestions),n=e.find(function(e){return e.id===t});n&&(n.showNotes=!n.showNotes,r.setState({trackingQuestions:e}))},i=n,s(r,i)}return a(e,t),e.prototype.componentDidMount=function(){this.getData(this.props)},e.prototype.componentWillReceiveProps=function(t){this.getData(t)},e.prototype.setTextareaHeights=function(){[].forEach.call(document.querySelectorAll("textarea"),function(t){t.style.height="auto",t.style.height=t.scrollHeight+"px"})},e.prototype.render=function(t,e){var n=this,r=e.date,i=e.questions,o=e.highlighted,s=e.trackingQuestions,a=e.yesterday,l=e.tomorrow;if(null===r)return null;var h=new Date(r);h.setDate(h.getDate()-1);var f=null===a?Object(c.l)(h):a,g=new Date(r);g.setDate(g.getDate()+1);var j=null===l?Object(c.l)(g):l;return Object(u.h)("div",{class:"wrap lift-children"},Object(u.h)(d.a,{title:Object(c.c)(r),lastLink:f,nextLink:j,actions:Object(u.h)("button",{type:"button",class:"button--reset",onClick:this.highlightDay},Object(u.h)("svg",{width:"1em",height:"1em",viewBox:"0 0 22 22",xmlns:"http://www.w3.org/2000/svg"},Object(u.h)("path",{stroke:o?"currentColor":"var(--line)","stroke-width":"2",d:"M11 1l3 6.3 7 1-5 4.8 1.2 7-6.2-3.3L4.8 20 6 13.1 1 8.3l7-1z",fill:o?"currentColor":"none","fill-rule":"evenodd","stroke-linecap":"round","stroke-linejoin":"round"})))}),null===i?null:i.length?i.map(function(t){var e=t.slug,r=t.text,i=t.answer,o=void 0===i?"":i;return Object(u.h)(p,{id:e,label:r,value:o,onInput:function(t){return n.updateAnswer(e,t)}})}):null,s.map(function(t){return Object(u.h)("div",{key:t.slug,class:"tracking-question","data-question-type":t.settings.type},Object(u.h)("header",{class:"tracking-question__header"},Object(u.h)("label",{for:t.id,dir:"auto"},t.title),!1===t.notes?null:Object(u.h)("button",{type:"button",class:"button--reset","aria-label":"Add notes",onClick:function(){return n.showNotes(t.id)}},Object(u.h)("svg",{width:"20",height:"20",xmlns:"http://www.w3.org/2000/svg"},Object(u.h)("g",{"stroke-width":"2",fill:"none","fill-rule":"evenodd","stroke-linecap":"round","stroke-linejoin":"round"},Object(u.h)("path",{d:"M19 13a2 2 0 01-2 2H5l-4 4V3c0-1.1.9-2 2-2h14a2 2 0 012 2v10z",fill:t.showNotes?"#B9BCC6":null,stroke:"#B9BCC6"}),Object(u.h)("path",{stroke:t.showNotes?"#FFF":"#B9BCC6",d:"M9.8 5v6.5M6.5 8.5H13"}))))),"checkbox"===t.settings.type||"radio"===t.settings.type?Object(u.h)(y,{id:t.id,type:t.settings.type,value:t.answer?t.answer.value:t.settings.default,options:t.settings.options,onChange:function(e){return n.toggleTrackingOption(t.id,e)}}):null,"lightswitch"===t.settings.type?Object(u.h)(m,{id:t.id,value:t.answer?t.answer.value:t.settings.default,onChange:function(e){return n.updateTrackingAnswer(t.id,e)}}):null,"select"===t.settings.type?Object(u.h)(w,{id:t.id,value:t.answer?t.answer.value[0]||t.settings.default:t.settings.default,options:t.settings.options,onChange:function(e){return n.toggleTrackingOption(t.id,e)}}):null,"star"===t.settings.type?Object(u.h)(b,{id:t.id,value:t.answer?t.answer.value:t.settings.default||null,onChange:function(e){return n.updateTrackingAnswer(t.id,e)}}):null,"number"===t.settings.type?Object(u.h)(v,{id:t.id,value:t.answer?t.answer.value:t.settings.default||null,settings:t.settings,onChange:function(e){return n.updateTrackingAnswer(t.id,e)}}):null,"plus"===t.settings.type?Object(u.h)(O,{id:t.id,value:t.answer?t.answer.value:t.settings.default||null,settings:t.settings,onChange:function(e){return n.updateTrackingAnswer(t.id,e)}}):null,"range"===t.settings.type?Object(u.h)(k,{id:t.id,value:t.answer?t.answer.value:t.settings.default||null,settings:t.settings,onChange:function(e){return n.updateTrackingAnswer(t.id,e)}}):null,t.showNotes&&Object(u.h)(p,{id:t.id+"_notes",label:!0===t.notes?"Additional notes":t.notes,value:t.answer?t.answer.notes||"":"",onInput:function(e){return n.updateTrackingNotes(t.id,e)}}))}),i.length||s.length?null:C)},e}(u.Component);e.default=Object(f.connect)("db")(x)}});
//# sourceMappingURL=route-day.chunk.8ae19.js.map