webpackJsonp([2],{JiZg:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var r=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return 1!==e?n||t+"s":t}},OHvr:function(t,e,n){"use strict";function r(t){if(null==t)throw new TypeError("Cannot destructure undefined")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=n("KM04"),u=n("o6ac"),c=n("sw5u"),i=n("JiZg"),l=n("8EZx"),h=["i","a","and","the","in","of","to","then","they","was","for","with","it","we","on","an","but","at","had","so","went","up","some","got","my","be","that","this","i'm","made","out","it's","is","did","me","too","how","off","as"],b=n("b1q8"),f=Object(l.l)(),p=Object(a.h)(c.Link,{href:"/highlights/"},"here"),d=Object(a.h)("p",null,"Your most popular words are:"),O=Object(a.h)("br",null),g=Object(a.h)("hr",null),j=Object(a.h)("h2",null,"Personal Statistics"),v=Object(a.h)("option",{value:"0"},"All time"),y=Object(a.h)("option",{value:"7"},"7 days"),w=Object(a.h)("option",{value:"14"},"14 days"),m=Object(a.h)("option",{value:"30"},"30 days"),k=Object(a.h)("option",{value:"365"},"365 days"),P=Object(a.h)("div",null),S=Object(a.h)("p",null,"There's not quite enough data to gather stats. "," ",Object(a.h)("br",null),Object(a.h)("br",null),Object(a.h)(c.Link,{href:f},"start writing"),"!"),D=Object(a.h)("h1",{class:"mb20"},"Statistics & Reports"),E=Object(a.h)("hr",null),W=function(t){function e(){for(var e,n,r,s=arguments.length,a=Array(s),u=0;u<s;u++)a[u]=arguments[u];return e=n=o(this,t.call.apply(t,[this].concat(a))),n.state={totalEntries:0,uniqueDates:0,wordCount:0,totalHighlights:0,totalTrackingEntries:0,popularWords:[],showPopularWords:!1,showStopWords:!1,trackingQuestions:[],statOffset:0},n.getData=function(){return new Promise(function(t,e){var r,o,s,a,u,c,i,l,h,b,f,p,d=function(){try{return t()}catch(t){return e(t)}},O=function(){try{return d()}catch(t){return e(t)}};try{return Promise.resolve(n.props.db.keys("entries")).then(function(t){try{return r=t,o=r.length,s=r.map(function(t){return Number(t.split("_").shift())}),s.sort(function(t,e){return t-e}),a=s.reduce(n.removeDuplicates,[]),Promise.resolve(n.props.db.getAll("highlights")).then(function(t){try{return u=t,c=u.length,Promise.resolve(n.getPopularWords()).then(function(t){try{return i=t,l=i[0],h=i[1],Promise.resolve(n.getTrackingStats()).then(function(t){try{return b=t,f=b[0],p=b[1],n.setState({totalEntries:o,uniqueDates:a.length,wordCount:l,totalHighlights:c,popularWords:h,trackingQuestions:f,totalTrackingEntries:p}),d()}catch(t){return O()}},O)}catch(t){return O()}},O)}catch(t){return O()}},O)}catch(t){return O()}},O)}catch(t){O()}})},n.getTrackingStats=function(){return new Promise(function(t,e){var r,o,s,a,u,c;return Promise.resolve(Object(b.b)(n.props.db)).then(function(i){try{return r=i,Promise.resolve(n.props.db.getAll("trackingEntries")).then(function(i){try{return o=i,s=new Date,a=n.state.statOffset,u=""+s.getFullYear()+Object(l.a)(s.getMonth()+1)+Object(l.a)(s.getDate()),c=a?u-a:0,r.forEach(function(t){switch(t.answers=o.filter(function(e){return e.questionId===t.id}).filter(function(e){return e.value!==t.default}).filter(function(t){return!c||Number(t.dateString)>=c}),t.settings.calculation){case"average":t.instances=t.answers,t.stat=Math.round(t.answers.reduce(function(t,e){return t+e.value},0)/t.answers.length*1e3)/1e3;break;case"total":t.stat=Math.round(1e3*t.answers.reduce(function(t,e){return t+e.value},0))/1e3;break;case"count":t.instances=t.answers.filter(b.c),t.stat=t.instances.length}isNaN(t.stat)&&(t.stat=void 0)}),t([r.filter(function(t){return void 0!==t.stat}),o.length])}catch(t){return e(t)}},e)}catch(t){return e(t)}},e)})},n.getPopularWords=function(){return new Promise(function(t,e){var r,o,s,a,u,c;return r={},Promise.resolve(n.props.db.getAll("entries")).then(function(i){try{return o=i,Promise.resolve(n.props.db.getAll("trackingEntries").then(function(t){return t.map(function(t){return t.notes||""})})).then(function(i){try{return s=i,a=[].concat(o,s).reduce(function(t,e){var o=e.split(/[.\s,]+/).map(function(t){return t.toLowerCase()}).filter(Boolean);return o.filter(function(t){return n.state.showStopWords||!h.includes(t)}).forEach(function(t){return r[t]=r[t]?r[t]+1:1}),t+o.length},0),u=Array.from(new Set(Object.values(r).sort(function(t,e){return e-t}))),c=u.slice(0,50).map(function(t){return[t,Object.keys(r).filter(function(e){return r[e]===t}).join(", ")]}),t([a,c])}catch(t){return e(t)}},e)}catch(t){return e(t)}},e)})},r=e,o(n,r)}return s(e,t),e.prototype.componentDidMount=function(){this.getData()},e.prototype.componentWillReceiveProps=function(){this.getData()},e.prototype.removeDuplicates=function(t,e){return-1===t.indexOf(e)?[].concat(t,[e]):t},e.prototype.render=function(t,e){var n=this,o=e.totalEntries,s=e.uniqueDates,u=e.wordCount,h=e.totalHighlights,b=e.totalTrackingEntries,f=e.popularWords,W=e.showPopularWords,T=e.showStopWords,C=e.trackingQuestions,_=e.statOffset;r(t);var M=Object(l.d)(),A=(new Date).getDate()-1,q=Object(l.e)(),N=Object(a.h)("div",null,u?Object(a.h)("p",null,"You've written ",Object(a.h)("strong",null,u)," ",Object(i.a)("word",u)," in"," ",Object(a.h)("strong",null,o," ",Object(i.a)("entry",o,"entries"))," ","over"," ",Object(a.h)("strong",null,s," ",Object(i.a)("day",s)),"!"):null,h?Object(a.h)("p",null,"You've also highlighted ",Object(a.h)("strong",null,h)," ",Object(i.a)("day",h),". Check"," ",Object(i.a)("it",h,"them")," out"," ",p,"."):null,W&&f.length?Object(a.h)("div",null,d,Object(a.h)("table",{class:"left"},Object(a.h)("tbody",null,f.map(function(t){var e=t[0],n=t[1];return Object(a.h)("tr",{key:n},Object(a.h)("th",null,e),Object(a.h)("td",{class:"capitalize"},n))}))),O,T?null:Object(a.h)("button",{type:"button",class:"button button--grey",onClick:function(){n.setState({showStopWords:!0}),n.getData()}},"Include stop words")):u?Object(a.h)("button",{type:"button",class:"button button--grey",onClick:function(){return n.setState({showPopularWords:!0})}},"Show popular words"):null,b?Object(a.h)("div",{class:"mb40"},g,Object(a.h)("header",{class:"c-statistic-controls u-flex mb20"},j,Object(a.h)("select",{class:"c-select--small",value:_,onChange:function(t){n.setState({statOffset:Number(t.target.value)}),n.getData()}},v,y,w,m,k,Object(a.h)("option",{value:M},"This week"),Object(a.h)("option",{value:A},"This month"),Object(a.h)("option",{value:q},"This year"))),Object(a.h)("p",null,"You've tracked ",b," personal"," ",Object(i.a)("statistic",b)," on MindPalace."),C.map(function(t){return Object(a.h)("div",{class:"tracking-summary"},Object(a.h)("strong",null,t.title),Object(a.h)("span",{class:"tracking-summary__stat"},Object(a.h)("output",null,t.stat),Object(a.h)("small",null," (",t.settings.calculation,")")),t.instances&&t.instances.length?Object(a.h)(c.Link,{href:"/entries/"+t.id},"See all entries"):null)})):P),Y=S,x=0===Math.min(o,s,u)&&!b;return Object(a.h)("div",{class:"wrap wrap--thin lift-children"},D,E,Object(a.h)("div",null,x?Y:N))},e}(a.Component);e.default=Object(u.connect)("db")(W)}});
//# sourceMappingURL=route-stats.chunk.0e0cd.js.map